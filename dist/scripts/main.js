function run(){$(".info-open, .info-close, .overlay").click(function(){$("body").hasClass("side-open")?$("body").removeClass("side-open"):$("body").addClass("side-open")}),d3.csv("scripts/data.csv",function(t){return{bnppp:+t.BNPpp,bnppl:+t.BPNperLand,grijs:+t.GrijzeEnergie,hydro:+t.HydroEnergy,jaar:+t.Jaar,land:t.Land,oppervlakte:+t.Oppervlakte,populatie:+t.Populatie,total:+t.RenewableEnergy,solar:+t.SolarEnergy,wind:+t.WindEnergy,percentage:+t.percentageGroen}},function(t,e){function n(t){g.indexOf(t)<0&&(g.length>1&&g.splice(0,1),g.push(t),i())}function a(t,e){g[t]=e,i()}function r(t){$(".js-tooltip").hide(),d3.selectAll(".label").remove(),v=t,0>v&&(v=0),v>22&&(v=22),$(".timeline-current").css("width",b(v)+"%"),$(".timeline-year").css("left",b(v)-2.5+"%"),$(".timeline-year").text(1990+v),i()}function o(t,e){x&&(x=!1,setTimeout(function(){x=!0},e),r(v+t))}function i(){s();var t=g[0]-1,e=g[1]-1;H.scombobox("val",g[0].toString()),I.scombobox("val",g[1].toString()),$(".js-wind-1").text(Math.round(c[t].wind[v])),$(".js-water-1").text(Math.round(c[t].hydro[v])),$(".js-solar-1").text(Math.round(c[t].solar[v])),$(".js-green-1").text(Math.round(c[t].percentage[v])+"%"),$(".js-wind-2").text(Math.round(c[e].wind[v])),$(".js-water-2").text(Math.round(c[e].hydro[v])),$(".js-solar-2").text(Math.round(c[e].solar[v])),$(".js-green-2").text(Math.round(c[e].percentage[v])+"%");var n=$(".countries"),a=n.children()[t],r=n.children()[e];n.children().css("fill","#118DEE"),$(a).css("fill","#D50046"),$(r).css("fill","#D50046")}function s(){var t=m,e=d3.scale.linear().domain([d3.min(c,function(e){return d3.min(e[t],function(t){return t})}),d3.max(c,function(e){return d3.max(e[t],function(t){return t})})]).range([5,60]);d3.selectAll(".country").transition().duration(400).attr("cy",function(t,e){var n=t.s/c.length*360,a=n*Math.PI/180;return y(t.percentage[v])*Math.sin(a)}).attr("cx",function(t,e){var n=t.s/c.length*360,a=n*Math.PI/180;return y(t.percentage[v])*Math.cos(a)}).attr("r",function(n,a){return e(n[t][v])})}for(var c=[],l=0;l<e.length;l+=23){for(var u={bnppp:[],bnppl:[],grijs:[],hydro:[],jaar:[],land:e[l].land,oppervlakte:[],populatie:[],total:[],solar:[],wind:[],percentage:[]},d=0;23>d;d++){var p=l+d;u.bnppp.push(e[p].bnppp),u.bnppl.push(e[p].bnppl),u.grijs.push(e[p].grijs),u.hydro.push(e[p].hydro),u.jaar.push(e[p].jaar),u.oppervlakte.push(e[p].oppervlakte),u.populatie.push(e[p].populatie),u.total.push(e[p].total),u.solar.push(e[p].solar),u.wind.push(e[p].wind),u.percentage.push(e[p].percentage)}c.push(u)}var h=[{name:"0%",value:"0"},{name:"Europe Target by 2020 - 20%",value:"20"},{name:"40%",value:"40"},{name:"60%",value:"60"},{name:"80%",value:"80"},{name:"",value:"100"}],f=window.innerHeight-window.innerHeight/10;WIDTH=f,$(".vis-container").css("height",f),$(".vis-container").css("width",WIDTH),$(".vis-container").css("top",window.innerHeight/2-f/2),$(".vis-container").css("left",window.innerWidth/2-150-WIDTH/2),$(".js-tooltip").hide();var g=[Math.round(Math.random()*c.length),Math.round(Math.random()*c.length)],v=0,m="populatie",x=!0,y=d3.scale.linear().domain([100,0]).range([50,WIDTH/2-60]),w=d3.scale.linear().domain([0,13e8]).range([5,60]),b=d3.scale.linear().domain([0,22]).range([5,95]);c.forEach(function(t,e){t.s=e});var j=d3.select(".vis").append("svg").attr("width",WIDTH).attr("height",f),M=j.append("g").attr("transform","translate("+WIDTH/2+","+f/2+")"),k=d3.svg.arc().outerRadius(function(t){return y(t.value)}).startAngle(0).endAngle(2*Math.PI),P=M.append("g").attr("class","agreements");P.selectAll(".agreementsPaths").data(h).enter().append("path").attr("id",function(t,e){return"agreementsPath"+e}).attr("class","agreementsPath").attr("d",k),P.selectAll(".agreementsLabels").data(h).enter().append("text").attr("class","agreementsLabel").attr("dy",-5).attr("dx",0).style("text-anchor","middle").append("textPath").attr("xlink:href",function(t,e){return"#agreementsPath"+e}).attr("startOffset","50%").text(function(t,e){return t.name});var W=M.append("g").attr("class","countries");W.selectAll(".country").data(c).enter().append("circle").attr("class","country").attr("r",function(t,e){return w(t.populatie[v])}).attr("cy",function(t,e){var n=t.s/c.length*360,a=n*Math.PI/180;return y(t.percentage[v])*Math.sin(a)}).attr("cx",function(t,e){var n=t.s/c.length*360,a=n*Math.PI/180;return y(t.percentage[v])*Math.cos(a)}).on("mouseenter",function(t,e){var n=+$(this).attr("cx"),a=+$(this).attr("cy"),r=+$(this).attr("r"),o=WIDTH/2+n,i=f/2+a,s=$(".js-tooltip");s.show(),s.css("top",i+r/1.2),s.css("left",o+r/1.2),$(".js-country").text(t.land),$(".js-green-percentage").text(Math.round(t.percentage[v])),$(".js-green-total").text(Math.round(t.total[v]));var c=t.total[v]/t.percentage[v]*100;$(".js-grey-total").text(Math.round(c)),isNaN(c)&&$(".js-grey-total").text("-");var l=s.outerWidth(),u=s.outerHeight();n>0&&s.css("left",o-l-r/1.2),a>0&&s.css("top",i-u-r/1.2)}).on("mouseleave",function(t,e){$(".js-tooltip").hide()}).on("click",function(t,e){n(e+1),$(".country-dropdown .flash").css("opacity",1),setTimeout(function(){$(".country-dropdown .flash").css("opacity",0)},100)}),M.append("text").attr("text-anchor","middle").text("100%").attr("class","center-text"),M.append("text").attr("text-anchor","middle").text("Green").attr("class","center-text unit").attr("y",13);$(document).keydown(function(t){switch(t.which){case 37:o(-1,150);break;case 39:o(1,150)}}),$(document).keyup(function(t){(37===t.which||39===t.which)&&(x=!0)});var H=$(".country-dropdown-1"),I=$(".country-dropdown-2");$(".country-dropdown").scombobox({fullMatch:!0,highlight:!1});var D=c.map(function(t,e){return{value:e+1,text:t.land}});H.scombobox("fill",D),I.scombobox("fill",D),H.scombobox("change",function(t){var e=this.value;a(0,+e)}),I.scombobox("change",function(t){var e=this.value;a(1,+e)});var T=$(".timeline");T.on("click",function(t){var e=t.clientX,n=window.innerWidth-window.innerWidth/10-300;e-=window.innerWidth/20;var a=Math.round(e/n*22);r(a)}),$(".button-prev").on("click",function(){r(v-1)}),$(".button-next").on("click",function(){r(v+1)}),$(".js-populatie-filter").on("click",function(){m="populatie",s()}),$(".js-oppervlakte-filter").on("click",function(){m="oppervlakte",s()}),$(".js-wind-filter").on("click",function(){m="wind",s()}),$(".js-hydro-filter").on("click",function(){m="hydro",s()}),$(".js-solar-filter").on("click",function(){m="solar",s()}),$('input[type="radio"]').keydown(function(t){var e=[37,38,39,40];return-1!==e.indexOf(t.which)?($(this).blur(),!1):void 0}),i(),s()})}$("document").ready(function(){var t={prefetch:!0,cacheLength:2,onStart:{duration:1e3,render:function(t){t.addClass("is-exiting"),e.restartCSSAnimations()}},onReady:{duration:0,render:function(t,e){t.removeClass("is-exiting"),t.html(e),run()}}},e=$("#main-wrapper").smoothState(t).data("smoothState")});